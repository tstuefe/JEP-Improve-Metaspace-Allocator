<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>source Sdiff src/hotspot/share/gc/shared </title>
</head><body id="SUNWwebrev">
<center><a href='../../../../../src/hotspot/share/gc/shared/gcVMOperations.hpp.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../index.html' target='_top'>index</a> <a href='../../../../../src/hotspot/share/gc/shared/generationSpec.cpp.sdiff.html' target='_top'>next &gt</a></center>
<h2>src/hotspot/share/gc/shared/genCollectedHeap.cpp</h2>
<a class="print" href="javascript:print()">Print this page</a>
<pre>rev <a href="https://bugs.openjdk.java.net/browse/JDK-60221">60221</a> : imported patch big.patch</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
  42 #include "gc/shared/gcTrace.hpp"
  43 #include "gc/shared/gcTraceTime.inline.hpp"
  44 #include "gc/shared/genArguments.hpp"
  45 #include "gc/shared/gcVMOperations.hpp"
  46 #include "gc/shared/genCollectedHeap.hpp"
  47 #include "gc/shared/genOopClosures.inline.hpp"
  48 #include "gc/shared/generationSpec.hpp"
  49 #include "gc/shared/gcInitLogger.hpp"
  50 #include "gc/shared/locationPrinter.inline.hpp"
  51 #include "gc/shared/oopStorage.inline.hpp"
  52 #include "gc/shared/oopStorageSet.inline.hpp"
  53 #include "gc/shared/oopStorageParState.inline.hpp"
  54 #include "gc/shared/scavengableNMethods.hpp"
  55 #include "gc/shared/space.hpp"
  56 #include "gc/shared/strongRootsScope.hpp"
  57 #include "gc/shared/weakProcessor.hpp"
  58 #include "gc/shared/workgroup.hpp"
  59 #include "memory/filemap.hpp"
  60 #include "memory/iterator.hpp"
  61 #include "memory/metaspaceCounters.hpp"

  62 #include "memory/resourceArea.hpp"
  63 #include "memory/universe.hpp"
  64 #include "oops/oop.inline.hpp"
  65 #include "runtime/biasedLocking.hpp"
  66 #include "runtime/handles.hpp"
  67 #include "runtime/handles.inline.hpp"
  68 #include "runtime/java.hpp"
  69 #include "runtime/vmThread.hpp"
  70 #include "services/management.hpp"
  71 #include "services/memoryService.hpp"
  72 #include "utilities/autoRestore.hpp"
  73 #include "utilities/debug.hpp"
  74 #include "utilities/formatBuffer.hpp"
  75 #include "utilities/macros.hpp"
  76 #include "utilities/stack.inline.hpp"
  77 #include "utilities/vmError.hpp"
  78 #if INCLUDE_JVMCI
  79 #include "jvmci/jvmci.hpp"
  80 #endif
  81 

</pre><hr></hr><pre>
 650     // is set, by calling increment_total_collections above. However, we also need to
 651     // account Full collections that had "complete" unset.
 652     if (!complete) {
 653       increment_total_full_collections();
 654     }
 655 
 656     collect_generation(_old_gen,
 657                        full,
 658                        size,
 659                        is_tlab,
 660                        run_verification &amp;&amp; VerifyGCLevel &lt;= 1,
 661                        do_clear_all_soft_refs,
 662                        true);
 663 
 664     // Adjust generation sizes.
 665     _old_gen-&gt;compute_new_size();
 666     _young_gen-&gt;compute_new_size();
 667 
 668     // Delete metaspaces for unloaded class loaders and clean up loader_data graph
 669     ClassLoaderDataGraph::purge();
<span class="changed"> 670     MetaspaceUtils::verify_metrics();</span>
 671     // Resize the metaspace capacity after full collections
 672     MetaspaceGC::compute_new_size();
 673     update_full_collections_completed();
 674 
 675     print_heap_change(pre_gc_values);
 676 
 677     // Track memory usage and detect low memory after GC finishes
 678     MemoryService::track_memory_usage();
 679 
 680     // Need to tell the epilogue code we are done with Full GC, regardless what was
 681     // the initial value for "complete" flag.
 682     gc_epilogue(true);
 683 
 684     BiasedLocking::restore_marks();
 685 
 686     print_heap_after_gc();
 687   }
 688 }
 689 
 690 bool GenCollectedHeap::should_do_full_collection(size_t size, bool full, bool is_tlab,

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
  42 #include "gc/shared/gcTrace.hpp"
  43 #include "gc/shared/gcTraceTime.inline.hpp"
  44 #include "gc/shared/genArguments.hpp"
  45 #include "gc/shared/gcVMOperations.hpp"
  46 #include "gc/shared/genCollectedHeap.hpp"
  47 #include "gc/shared/genOopClosures.inline.hpp"
  48 #include "gc/shared/generationSpec.hpp"
  49 #include "gc/shared/gcInitLogger.hpp"
  50 #include "gc/shared/locationPrinter.inline.hpp"
  51 #include "gc/shared/oopStorage.inline.hpp"
  52 #include "gc/shared/oopStorageSet.inline.hpp"
  53 #include "gc/shared/oopStorageParState.inline.hpp"
  54 #include "gc/shared/scavengableNMethods.hpp"
  55 #include "gc/shared/space.hpp"
  56 #include "gc/shared/strongRootsScope.hpp"
  57 #include "gc/shared/weakProcessor.hpp"
  58 #include "gc/shared/workgroup.hpp"
  59 #include "memory/filemap.hpp"
  60 #include "memory/iterator.hpp"
  61 #include "memory/metaspaceCounters.hpp"
<span class="new">  62 #include "memory/metaspace/metaspaceSizesSnapshot.hpp"</span>
  63 #include "memory/resourceArea.hpp"
  64 #include "memory/universe.hpp"
  65 #include "oops/oop.inline.hpp"
  66 #include "runtime/biasedLocking.hpp"
  67 #include "runtime/handles.hpp"
  68 #include "runtime/handles.inline.hpp"
  69 #include "runtime/java.hpp"
  70 #include "runtime/vmThread.hpp"
  71 #include "services/management.hpp"
  72 #include "services/memoryService.hpp"
  73 #include "utilities/autoRestore.hpp"
  74 #include "utilities/debug.hpp"
  75 #include "utilities/formatBuffer.hpp"
  76 #include "utilities/macros.hpp"
  77 #include "utilities/stack.inline.hpp"
  78 #include "utilities/vmError.hpp"
  79 #if INCLUDE_JVMCI
  80 #include "jvmci/jvmci.hpp"
  81 #endif
  82 

</pre><hr></hr><pre>
 651     // is set, by calling increment_total_collections above. However, we also need to
 652     // account Full collections that had "complete" unset.
 653     if (!complete) {
 654       increment_total_full_collections();
 655     }
 656 
 657     collect_generation(_old_gen,
 658                        full,
 659                        size,
 660                        is_tlab,
 661                        run_verification &amp;&amp; VerifyGCLevel &lt;= 1,
 662                        do_clear_all_soft_refs,
 663                        true);
 664 
 665     // Adjust generation sizes.
 666     _old_gen-&gt;compute_new_size();
 667     _young_gen-&gt;compute_new_size();
 668 
 669     // Delete metaspaces for unloaded class loaders and clean up loader_data graph
 670     ClassLoaderDataGraph::purge();
<span class="changed"> 671     DEBUG_ONLY(MetaspaceUtils::verify(false);)</span>
 672     // Resize the metaspace capacity after full collections
 673     MetaspaceGC::compute_new_size();
 674     update_full_collections_completed();
 675 
 676     print_heap_change(pre_gc_values);
 677 
 678     // Track memory usage and detect low memory after GC finishes
 679     MemoryService::track_memory_usage();
 680 
 681     // Need to tell the epilogue code we are done with Full GC, regardless what was
 682     // the initial value for "complete" flag.
 683     gc_epilogue(true);
 684 
 685     BiasedLocking::restore_marks();
 686 
 687     print_heap_after_gc();
 688   }
 689 }
 690 
 691 bool GenCollectedHeap::should_do_full_collection(size_t size, bool full, bool is_tlab,

</pre><hr></hr>
</pre></td>
</tr></table>
<center><a href='../../../../../src/hotspot/share/gc/shared/gcVMOperations.hpp.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../../index.html' target='_top'>index</a> <a href='../../../../../src/hotspot/share/gc/shared/generationSpec.cpp.sdiff.html' target='_top'>next &gt</a></center>
</body></html>
